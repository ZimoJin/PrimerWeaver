<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Primer QC - PrimerWeaver</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            line-height: 1.6;
            max-width: 1000px;
            margin: 40px auto;
            padding: 20px;
            color: #333;
            background: #f9fafb;
        }
        .container {
            background: white;
            padding: 40px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        h1 {
            color: #1e40af;
            border-bottom: 3px solid #2563eb;
            padding-bottom: 10px;
            margin-bottom: 30px;
        }
        h2 {
            color: #2563eb;
            margin-top: 2em;
            margin-bottom: 1em;
            font-size: 1.5em;
        }
        h3 {
            color: #3b82f6;
            margin-top: 1.5em;
            margin-bottom: 0.8em;
            font-size: 1.2em;
        }
        h4 {
            color: #60a5fa;
            margin-top: 1.2em;
            margin-bottom: 0.6em;
        }
        p {
            margin-bottom: 1em;
            text-align: justify;
        }
        ul, ol {
            margin-left: 25px;
            margin-bottom: 1em;
        }
        li {
            margin-bottom: 0.5em;
        }
        strong {
            color: #1e40af;
            font-weight: 600;
        }
        code {
            background: #f1f5f9;
            padding: 2px 6px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
            color: #c2410c;
        }
        pre {
            background: #1e293b;
            color: #e2e8f0;
            padding: 15px;
            border-radius: 8px;
            overflow-x: auto;
            margin: 1em 0;
            width: fit-content;
        }
        .code-examples {
            display: flex;
            gap: 2em;
            margin: 1em 0;
        }
        .code-example-group {
            flex: 1;
            min-width: 0;
        }
        .code-example-group h4 {
            margin-top: 0;
            margin-bottom: 0.5em;
        }
        pre code {
            background: transparent;
            color: inherit;
            padding: 0;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 1.5em 0;
            font-size: 0.95em;
        }
        th, td {
            border: 1px solid #e2e8f0;
            padding: 12px;
            text-align: left;
        }
        th {
            background: #f1f5f9;
            color: #1e40af;
            font-weight: 600;
        }
        tr:nth-child(even) {
            background: #f8fafc;
        }
        .abstract {
            background: #eff6ff;
            border-left: 4px solid #2563eb;
            padding: 20px;
            margin: 2em 0;
            border-radius: 4px;
        }
        .abstract p {
            margin: 0;
            font-style: italic;
        }
        .highlight {
            background: #fef3c7;
            padding: 2px 4px;
            border-radius: 3px;
        }
        .section {
            margin-bottom: 2.5em;
        }
        .reference {
            font-size: 0.9em;
            margin-left: 20px;
            margin-bottom: 0.5em;
        }
        .version-info {
            text-align: center;
            color: #64748b;
            font-size: 0.9em;
            margin-top: 3em;
            padding-top: 2em;
            border-top: 1px solid #e2e8f0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Primer QC Module Documentation</h1>
        
        <div class="abstract">
            <p>Primer QC supports multiple practical scenarios encountered in routine molecular biology workflows. It can be used to validate primer sequences obtained from publications, databases, or previous experiments before ordering new oligonucleotides, and to assess the compatibility of existing primer pairs. The module also facilitates troubleshooting by identifying primer features that may lead to PCR failure, enabling users to understand why certain primers perform poorly. In addition, Primer QC allows comparison of multiple primer candidates to aid optimization and serves as an educational resource for understanding fundamental primer design principles and thermodynamic parameters affecting PCR performance.</p>
        </div>

        <div class="section">
            <h2>Quick Start Guide</h2>
            
            <ol>
                <li>Upload or paste your primer sequences in the corresponding input fields, adjust Na⁺, Mg²⁺, primer concentration and target Tm if needed. For detailed format requirement and parameter setting, please refer to the detailed guide below or the help icon in the QC module.
                
                <div style="text-align: center; margin: 2em 0;">
                    <img
                        src="contents/pictures/QC_demo.png"
                        alt="Primer QC demo"
                        style="max-width: 90%; height: auto; border-radius: 8px;"
                    >
                </div>
                </li>
                
                                
                <li>Click the "Run QC" button to perform the quality assessment. The results will be displayed in the output section, showing thermodynamic parameters, secondary structure formation, and primer-pair compatibility.

                </li>
            </ol>
        </div>

        <div class="section">
            <h2>Primer QC Principle</h2>
            
            <p>Primer quality control is a critical component of PCR experimental design and troubleshooting. High-quality primers exhibit specific binding to intended targets, efficient annealing under reaction conditions, and minimal tendency to form undesired secondary structures or primer dimers. This module evaluates primers across multiple dimensions using nearest-neighbor thermodynamic modeling, systematic secondary structure prediction, and an integrated reliability scoring system.</p>
            
            <h3>Key Evaluation Criteria</h3>
            <ul>
                <li><strong>Thermodynamic Properties:</strong> Melting temperature (Tm), GC content, and 3′-end stability are calculated using unified nearest-neighbor thermodynamic parameters with explicit salt corrections for Na⁺ and Mg²⁺ ions.</li>
                <li><strong>Secondary Structure Formation:</strong> The module identifies and evaluates hairpin structures within individual primers and dimer formation between primer pairs, calculating Gibbs free energy (ΔG) to assess stability and likelihood of occurrence.</li>
                <li><strong>Primer Pair Compatibility:</strong> Forward and reverse primers are evaluated for cross-dimer formation, melting temperature matching, and overall amplification efficiency through a comprehensive reliability score combining multiple quality metrics.</li>
                <li><strong>Sequence Quality Metrics:</strong> Homopolymer runs, 3′-end base pairing strength, and IUPAC degenerate base handling are assessed to identify potential sources of non-specific amplification or reduced specificity.</li>
            </ul>

        </div>

        <div class="section">
            <h2>Input Format</h2>
            
            <h3>Sequence Format Support</h3>
            <p>This module accept <strong>both multi-FASTA and plain text format</strong>. The current upload size limit is 1 MB; however, the user interface may become unstable when processing very large inputs. We therefore recommend limiting each run to <strong>no more than 500 sequences</strong>. The system supports <strong>both canonical DNA bases (A, T, G, C) and IUPAC degenerate bases (R, Y, S, W, K, M, B, D, H, V, N)</strong>. These bases are integrated into complementary pairing and thermodynamic calculations. Non-IUPAC characters are removed during normalization with user confirmation. Primers containing degenerate bases are marked with an asterisk (*) in results.</p>

		<div style="text-align: center; margin: 2em 0;">
                    <img
                        src="contents/pictures/qc_input_format.png"
                        alt="Primer QC Input Format"
                        style="max-width: 60%; height: auto; border-radius: 8px;"
                    >
                </div>


            
            <h3>Primer Pairing Recognition</h3>
            <p>The tool automatically recognizes and pairs primers using flexible naming conventions. If pairing is ambiguous, the report indicates unpaired primers without performing cross-primer dimer checking. Supported naming patterns include:</p>
            <ul>
                <li><code>Target1-F / Target1-R</code> (with dash)</li>
                <li><code>Target1_F / Target1_R</code> (with underscore)</li>
                <li><code>Target1F / Target1R</code> (no separator)</li>
                <li><code>Target1-Forward / Target1-Reverse</code> (full words)</li>
                <li><code>Target1_Forward / Target1_Reverse</code> (full words with underscore)</li>
                <li><code>Target1-fwd / Target1-rev</code> (abbreviated)</li>
                <li><code>Target1_FWD / Target1_REV</code> (uppercase abbreviated)</li>
            </ul>

        </div>

        <div class="section">
            <h2>QC Parameters</h2>
            
            <p>Before running quality control analysis, review and adjust the following parameters to match your PCR reaction conditions.</p>
            
            <table>
                <thead>
                    <tr>
                        <th>Parameter</th>
                        <th>Default</th>
                        <th>Range</th>
                        <th>Description</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><strong>Na⁺ Concentration (mM)</strong></td>
                        <td>50</td>
                        <td>0–200</td>
                        <td>Monovalent cation concentration used for salt-corrected Tm calculation. Typical range: 10-200 mM.</td>
                    </tr>
                    <tr>
                        <td><strong>Mg²⁺ Concentration (mM)</strong></td>
                        <td>2.0</td>
                        <td>0–10</td>
                        <td>Divalent cation concentration used for Tm calculation. Set to 0 if Mg²⁺ is absent from reaction. Typical range: 0.5-5 mM.</td>
                    </tr>
                    <tr>
                        <td><strong>Primer Concentration (nM)</strong></td>
                        <td>500</td>
                        <td>50–2000</td>
                        <td>Effective primer concentration assumed for in silico Tm calculation. Typical range: 25-1000 nM.</td>
                    </tr>
                    <tr>
                        <td><strong>Target Tm (°C)</strong></td>
                        <td>60</td>
                        <td>40–75</td>
                        <td>Target melting temperature for evaluation. Tm values of evaluated primers are compared against this reference to assess annealing compatibility. Typical range: 50-65°C.</td>
                    </tr>
                </tbody>
            </table>

        </div>

        <div class="section">
            <h2>Results and Output</h2>
            
            <p>After running QC analysis, the module generates comprehensive results evaluating individual primer properties, primer-pair compatibility, and overall reliability.</p>

            <p>For each primer, the tool displays a comprehensive metrics table including:</p>

            <table>
                <thead>
                    <tr>
                        <th>Metric</th>
                        <th>Description</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><strong>Primer</strong></td>
                        <td>Primer name/label (marked with * if degenerate bases present)</td>
                    </tr>
                    <tr>
                        <td><strong>Len</strong></td>
                        <td>Primer length in nucleotides</td>
                    </tr>
                    <tr>
                        <td><strong>GC%</strong></td>
                        <td>GC content percentage (typically optimal at 40–60%)</td>
                    </tr>
                    <tr>
                        <td><strong>Tm (Δ)</strong></td>
                        <td>Calculated melting temperature and difference (ΔTm) from target Tm</td>
                    </tr>
                    <tr>
                        <td><strong>3′ clamp</strong></td>
                        <td>Terminal base pair identity (G/C preferred, A/T acceptable)</td>
                    </tr>
                    <tr>
                        <td><strong>Homopoly</strong></td>
                        <td>Homopolymer run detection status (OK or High)</td>
                    </tr>
                    <tr>
                        <td><strong>Hairpin</strong></td>
                        <td>Hairpin secondary structure classification (None, Weak, Moderate, Strong)</td>
                    </tr>
                    <tr>
                        <td><strong>ΔG(3′ 5bp)</strong></td>
                        <td>Gibbs free energy of 3′-terminal 5-base window (indicates stability)</td>
                    </tr>
                    <tr>
                        <td><strong>Self-dimer</strong></td>
                        <td>Self-dimer formation classification and stability</td>
                    </tr>
                    <tr>
                        <td><strong>Cross-dimer</strong></td>
                        <td>Cross-dimer formation between primer pairs (for paired primers)</td>
                    </tr>
                </tbody>
            </table>

            
            <h3>Reliability Score</h3>
            <p>A composite score (0–100) is calculated combining multiple quality metrics:</p>
            <ul>
                <li>Individual primer quality scores (45% weight each for forward and reverse primers)</li>
                <li>Cross-dimer formation assessment (penalty or bonus)</li>
                <li>Melting temperature matching assessment (penalty if ΔTm &gt; 5°C)</li>
            </ul>
            
            <h4>Score Classification</h4>
            <ul>
                <li><strong>Excellent (≥85):</strong> High-quality primer pair, ready for use in PCR</li>
                <li><strong>Acceptable (65–84):</strong> Good quality with minor concerns, generally suitable for PCR</li>
                <li><strong>Risky (&lt;65):</strong> Significant issues detected, review and optimization recommended before use</li>
            </ul>
            
            <h3>Predicted Secondary Structures</h3>
            <p>When dimers or hairpins are detected, the tool provides visual alignment of the structure, calculated ΔG value, classification level (None, Weak, Moderate, Strong), and warning flags for 3′-end interactions that may impair PCR performance.</p>
            
            <div style="text-align: center; margin: 2em 0;">
                <img
                    src="contents/pictures/qc_2nd_structure.png"
                    alt="Primer QC secondary structures and dimer visualization"
                    style="max-width: 70%; height: auto; border-radius: 8px;"
                >
            </div>

        </div>

        <div class="section">
            <h2>Calculation Methods and Algorithms</h2>
            
            <h3>Nearest-Neighbor Thermodynamic Model Parameters</h3>
        <p>The tool uses the unified nearest-neighbor (NN) parameters from SantaLucia (1998) and Allawi & SantaLucia (1997) with an initiation correction. For sequences containing IUPAC degenerate bases, the QC engine expands each base into its possible concrete bases and applies a conservative worst-case assumption: for each dinucleotide step, it chooses the combination producing the most stable interaction (lowest ΔG at 37 °C). This avoids underestimating binding strength.</p>
        <table>
                <thead>
                    <tr>
                        <th>Nearest Neighbor</th>
                        <th>ΔH° (kcal/mol)</th>
                        <th>ΔS° (cal/mol·K)</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>AA/TT</td>
                        <td>-7.9</td>
                        <td>-22.2</td>
                    </tr>
                    <tr>
                        <td>AT/TA</td>
                        <td>-7.2</td>
                        <td>-20.4 / -21.3</td>
                    </tr>
                    <tr>
                        <td>CA/TG</td>
                        <td>-8.5</td>
                        <td>-22.7</td>
                    </tr>
                    <tr>
                        <td>GT/AC</td>
                        <td>-8.4</td>
                        <td>-22.4</td>
                    </tr>
                    <tr>
                        <td>CT/AG</td>
                        <td>-7.8</td>
                        <td>-21.0</td>
                    </tr>
                    <tr>
                        <td>GA/TC</td>
                        <td>-8.2</td>
                        <td>-22.2</td>
                    </tr>
                    <tr>
                        <td>CG/GC</td>
                        <td>-10.6 / -9.8</td>
                        <td>-27.2 / -24.4</td>
                    </tr>
                    <tr>
                        <td>GG/CC</td>
                        <td>-8.0</td>
                        <td>-19.9</td>
                    </tr>
                </tbody>
            </table>
            <h3>Melting Temperature (Tm) Calculation</h3>
            <p>Implements the unified nearest-neighbor thermodynamic model, with explicit support for monovalent (Na⁺) and divalent (Mg²⁺) cation effects. Primer melting temperatures are further adjusted for oligonucleotide concentration according to the formulation described below.</p>
            
            <div style="background: #f8fafc; padding: 15px; border-radius: 8px; margin: 1em 0; text-align: center; font-family: 'Times New Roman', serif; font-size: 1.1em;">
                <p style="margin: 0;">T<sub>m</sub> = ΔH° / (ΔS° + R × ln(C<sub>T</sub>/4)) - 273.15 + 16.6 × log[Na<sup>+</sup><sub>eq</sub>]</p>
                <p style="font-size: 0.85em; color: #666; margin-top: 0.5em; margin-bottom: 0;">Where Na<sup>+</sup><sub>eq</sub> includes the effect of Mg<sup>2+</sup> concentration.</p>
            </div>

            <h3>GC Content Analysis</h3>
            <p>Supports IUPAC degenerate base codes, calculates GC content percentage based on the formula described below, and identifies primers with suboptimal GC content (typically 40-60% recommended).</p>
            
            <div style="background: #f8fafc; padding: 15px; border-radius: 8px; margin: 1em 0; text-align: center; font-family: 'Times New Roman', serif; font-size: 1.1em;">
                <p style="margin: 0;">%GC = [Count(G) + Count(C)] / Total Length × 100</p>
            </div>


            <h3>Secondary Structure Analysis</h3>

            <h4>Self-Dimer Detection</h4>
            <ul>
                <li>Comprehensive scanning for potential self-dimer formation</li>
                <li>Calculates Gibbs free energy (ΔG) for dimer structures</li>
                <li>Classifies dimers as:
                    <ul>
                        <li><strong>None</strong>: No significant dimer formation (ΔG &gt; -3 kcal/mol)</li>
                        <li><strong>Weak</strong>: Moderate stability (-5 &lt; ΔG ≤ -3 kcal/mol)</li>
                        <li><strong>Moderate</strong>: Significant stability (-7 &lt; ΔG ≤ -5 kcal/mol)</li>
                        <li><strong>Strong</strong>: High stability (ΔG ≤ -7 kcal/mol)</li>
                    </ul>
                </li>
                <li>Special attention to 3'-end interactions, which are particularly problematic for PCR</li>
            </ul>

            <h4>Hairpin Detection</h4>
            <ul>
                <li>Identifies potential hairpin structures with loop sizes from 3 to 9 nucleotides</li>
                <li>Incorporates loop entropy penalties based on SantaLucia (2004) parameters</li>
                <li>Calculates ΔG for hairpin formation, accounting for:
                    <ul>
                        <li>Base-pairing in the stem region</li>
                        <li>Loop size and entropy</li>
                        <li>Terminal mismatches</li>
                    </ul>
                </li>
                <li>Classifies hairpins using the same energy thresholds as dimers</li>
            </ul>

            <h4>Cross-Dimer Analysis</h4>
            <ul>
                <li>Evaluates potential dimer formation between forward and reverse primers</li>
                <li>Critical for primer pair validation</li>
                <li>Provides visual alignment of dimer structures when detected</li>
                <li>Warns about 3'-end interactions that can cause primer-dimer artifacts</li>
            </ul>

            <h4>Dimer Scanning Algorithm</h4>
            <ol>
                <li><strong>Sliding Window Approach</strong>
                    <ul>
                        <li>Examines all possible alignments between primer sequences</li>
                        <li>Considers both direct and reverse complement orientations</li>
                        <li>Tests alignments with gaps and overhangs</li>
                    </ul>
                </li>
                <li><strong>Energy Calculation:</strong>
                    <ul>
                        <li>Sums nearest-neighbor ΔH° and ΔS° values for matched regions</li>
                        <li>Applies salt correction</li>
                        <li>Accounts for terminal mismatches and bulges</li>
                    </ul>
                </li>
                <li><strong>3'-End Interaction Detection:</strong>
                    <ul>
                        <li>Special flagging when dimer interactions involve the 3' end</li>
                        <li>Critical for PCR as extension starts at the 3' terminus</li>
                    </ul>
                </li>
            </ol>

            <h3>Hairpin Detection Algorithm</h3>
            <ol>
		<li><strong>Stem Identification:</strong>
                    <ul>
                        <li>Searches for complementary regions within the primer</li>
                        <li>Minimum stem length: 3 base pairs</li>
                        <li>Allows for internal loops and bulges</li>
                    </ul>
                </li> 
		<li><strong>Loop Entropy Penalty:</strong>
                    <ul>
                        <li>Applies size-dependent entropy penalties:
                            <ul>
                                <li>3-nt loop: +5.7 kcal/mol</li>
                                <li>4-nt loop: +5.6 kcal/mol</li>
                                <li>5-nt loop: +4.9 kcal/mol</li>
                                <li>6-nt loop: +4.4 kcal/mol</li>
                                <li>7-9-nt loops: +4.5-4.6 kcal/mol</li>
                            </ul>
                        </li>
                    </ul>
                </li>
                <li><strong>Energy Threshold:</strong>
                    <ul>
                        <li>Hairpins with ΔG ≤ -3 kcal/mol are considered significant</li>
                        <li>More stable hairpins (ΔG ≤ -7 kcal/mol) are flagged as critical</li>
                    </ul>
                </li> 
              
            </ol>

            </ul>
 	 

        <h3>Additional Quality Metrics</h3>

        <h4>3'-End Stability (3' Clamp)</h4>
        <ul>
            <li>Evaluates the 3'-terminal base pair stability</li>
            <li>G/C clamp (stronger) preferred over A/T clamp</li>
            <li>Critical for PCR efficiency as extension initiates at the 3' end</li>
        </ul>

        <h4>Homopolymer Detection</h4>
        <ul>
            <li>Identifies runs of identical bases (default threshold: 4 consecutive bases)</li>
            <li>Long homopolymers can cause slippage and non-specific amplification</li>
        </ul>

        <h4>IUPAC Degenerate Base Support</h4>
        <ul>
            <li>Full support for ambiguous DNA bases</li>
            <li>Tm and ΔG calculations use the most stable (worst-case) variant</li>
            <li>Clearly marked in results with asterisk (*)</li>
        </ul>

        <h3>Reliability Score Calculation</h3>
        <p>Calculates a composite score based on various primer quality metrics with 100 initial score:</p>
        <table>
            <thead>
                <tr>
                    <th>Rule</th>
                    <th>Penalty</th>
                </tr>
            </thead>
            <tbody>
                <tr><td>GC% outside 40–60%</td><td>−10</td></tr>
                <tr><td>Length outside 18–30 bp</td><td>−8</td></tr>
                <tr><td>No 3′ GC clamp</td><td>−5</td></tr>
                <tr><td>Homopolymer (≥4)</td><td>−8</td></tr>
                <tr><td>ΔG(3′ 5bp) ≤ −9</td><td>−10</td></tr>
                <tr><td>Self-dimer = BAD (strong/very strong)</td><td>−25</td></tr>
                <tr><td>Self-dimer = WARN (moderate)</td><td>−10</td></tr>
                <tr><td>Hairpin = BAD</td><td>−12</td></tr>
                <tr><td>Hairpin = WARN</td><td>−6</td></tr>
            </tbody>
        </table>

        <h4>Pair Score (0–100)</h4>
        <p>If both primers exist, the pair score is computed as:</p>
        <div style="background: #f8fafc; padding: 15px; border-radius: 8px; margin: 1em 0; text-align: center; font-family: 'Times New Roman', serif; font-size: 1.1em;">
            <p style="margin: 0;">Score<sub>pair</sub> = 0.45 &times; Score<sub>F</sub> + 0.45 &times; Score<sub>R</sub> + pp</p>
        </div>
        <p>Where <code>pp</code> depends on cross-dimer classification:</p>
        <ul>
            <li>Cross-dimer OK: +10</li>
            <li>Cross-dimer WARN: −10</li>
            <li>Cross-dimer BAD: −25</li>
        </ul>
        <p>If ΔTm &gt; 5 °C, then <code>pp -= 10</code>. Final score is clamped to [0, 100].</p>
        </div>


    </div>
</body>
</html>
