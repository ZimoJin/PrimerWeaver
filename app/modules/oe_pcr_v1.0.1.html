<div class="tabs">
  <div style="display:flex; align-items:center; gap:8px; width:100%;">
    <div style="font-weight:700; display:flex; align-items:center; gap:8px;">
      <span>Input Sequences</span>
      <span class="help-icon" style="position: relative; display: inline-block; cursor: help; z-index: 1; flex-shrink: 0;">
        <span style="display: inline-block; width: 16px; height: 16px; line-height: 16px; text-align: center; border-radius: 50%; background: #6b7280; color: white; font-size: 0.7rem; font-weight: bold; transition: background 0.2s; position: relative; z-index: 1;">?</span>
        <span class="help-tooltip" style="position: absolute; top: calc(100% + 10px); left: 0; width: 450px; padding: 14px; background: #1f2937; color: #fff; border-radius: 8px; font-size: 0.85rem; line-height: 1.6; opacity: 0; visibility: hidden; transition: opacity 0.3s, visibility 0.3s; z-index: 999999 !important; box-shadow: 0 8px 24px rgba(0,0,0,0.4); pointer-events: none; white-space: normal;">
          <p style="margin: 0 0 8px 0;">Add DNA sequences in order (FASTA format supported - name will be auto-extracted). Optionally specify linker sequences between fragments (DNA or amino acid sequence - AA will be converted using host organism codon preferences).</p>
          <p style="margin: 8px 0 0 0; padding-top: 8px; border-top: 1px solid rgba(255,255,255,0.2);">Sequences will be joined in the order they are added, with overlap regions designed automatically.</p>
          <span style="position: absolute; top: -6px; left: 20px; width: 0; height: 0; border-left: 6px solid transparent; border-right: 6px solid transparent; border-bottom: 6px solid #1f2937;"></span>
        </span>
      </span>
    </div>
    <div style="display:flex;gap:8px; margin-left:auto;">
      <button class="demo btn" id="demo-set-btn" type="button">Demo Set</button>
      <button class="ghost btn" id="global-reset" type="button">Reset</button>
    </div>
  </div>
</div>

<section class="pane" style="position: relative; overflow: visible;">
  <div>
    <table class="fragment-table" style="table-layout: fixed; overflow: visible;">
      <thead>
        <tr>
          <th style="width: 2%;">#</th>
          <th id="dna-seq-header" style="width: 65%;">
            <div style="display:flex; align-items:center; justify-content: space-between; gap:8px;">
              <span>DNA Sequence</span>
              <span style="display:flex; gap:6px; align-items:center;">
                <button class="ghost btn" id="toggle-linker" type="button" title="Show/hide linker column">Show Linker</button>
                <button class="ghost btn" id="flip-order" type="button" title="Reverse the order of fragments without changing sequences">Flip order</button>
                <button class="ghost btn" id="add-fragment-row" type="button">+ Add Fragment</button>
              </span>
            </div>
          </th>
          <th class="linker-column" style="width: 30%; display: none;">Linker (after this fragment)</th>
          <th style="width: 3%; text-align: left; padding-left: 2px;"></th>
        </tr>
      </thead>
      <tbody id="fragment-rows">
        <!-- Dynamically generated rows -->
      </tbody>
    </table>
  </div>

  <div style="margin-top:12px;">
    <h2 style="display: flex; align-items: center; gap: 6px; position: relative; overflow: visible;">
      <span>Primer Design Parameters</span>
    </h2>
    <div class="grid cols-5" style="margin-top:10px; position: relative; overflow: visible;">
      <div style="position: relative; overflow: visible;">
        <label class="aside" style="display: flex; align-items: center; gap: 6px; position: relative; overflow: visible;">
          <span>Core primers Tm (°C)</span>
          <span class="help-icon" style="position: relative; display: inline-block; cursor: help; z-index: 1; flex-shrink: 0;">
            <span style="display: inline-block; width: 16px; height: 16px; line-height: 16px; text-align: center; border-radius: 50%; background: #6b7280; color: white; font-size: 0.7rem; font-weight: bold; transition: background 0.2s; position: relative; z-index: 1;">?</span>
            <span class="help-tooltip" style="position: absolute; top: calc(100% + 10px); left: 0; width: 280px; padding: 12px; background: #1f2937; color: #fff; border-radius: 8px; font-size: 0.85rem; line-height: 1.5; opacity: 0; visibility: hidden; transition: opacity 0.3s, visibility 0.3s; z-index: 999999 !important; box-shadow: 0 8px 24px rgba(0,0,0,0.4); pointer-events: none; white-space: normal;">
              <p style="margin: 0;">Target melting temperature for the core primer region that binds to the template DNA. Typical range: 50-65°C.</p>
              <span style="position: absolute; top: -6px; left: 20px; width: 0; height: 0; border-left: 6px solid transparent; border-right: 6px solid transparent; border-bottom: 6px solid #1f2937;"></span>
            </span>
          </span>
        </label>
        <input type="number" id="core-tm" value="55" min="40" max="80" step="1">
      </div>
      <div style="position: relative; overflow: visible;">
        <label class="aside" style="display: flex; align-items: center; gap: 6px; position: relative; overflow: visible;">
          <span>Overlap primers Tm (°C)</span>
          <span class="help-icon" style="position: relative; display: inline-block; cursor: help; z-index: 1; flex-shrink: 0;">
            <span style="display: inline-block; width: 16px; height: 16px; line-height: 16px; text-align: center; border-radius: 50%; background: #6b7280; color: white; font-size: 0.7rem; font-weight: bold; transition: background 0.2s; position: relative; z-index: 1;">?</span>
            <span class="help-tooltip" style="position: absolute; top: calc(100% + 10px); left: 0; width: 280px; padding: 12px; background: #1f2937; color: #fff; border-radius: 8px; font-size: 0.85rem; line-height: 1.5; opacity: 0; visibility: hidden; transition: opacity 0.3s, visibility 0.3s; z-index: 999999 !important; box-shadow: 0 8px 24px rgba(0,0,0,0.4); pointer-events: none; white-space: normal;">
              <p style="margin: 0;">Target melting temperature for the overlap region that allows fragments to anneal. Typically similar to core Tm. Typical range: 50-65°C.</p>
              <span style="position: absolute; top: -6px; left: 20px; width: 0; height: 0; border-left: 6px solid transparent; border-right: 6px solid transparent; border-bottom: 6px solid #1f2937;"></span>
            </span>
          </span>
        </label>
        <input type="number" id="overlap-tm" value="55" min="40" max="80" step="1">
      </div>
      <div style="position: relative; overflow: visible;">
        <label class="aside" style="display: flex; align-items: center; gap: 6px; position: relative; overflow: visible;">
          <span>Primer conc. (nM)</span>
          <span class="help-icon" style="position: relative; display: inline-block; cursor: help; z-index: 1; flex-shrink: 0;">
            <span style="display: inline-block; width: 16px; height: 16px; line-height: 16px; text-align: center; border-radius: 50%; background: #6b7280; color: white; font-size: 0.7rem; font-weight: bold; transition: background 0.2s; position: relative; z-index: 1;">?</span>
            <span class="help-tooltip" style="position: absolute; top: calc(100% + 10px); left: 0; width: 280px; padding: 12px; background: #1f2937; color: #fff; border-radius: 8px; font-size: 0.85rem; line-height: 1.5; opacity: 0; visibility: hidden; transition: opacity 0.3s, visibility 0.3s; z-index: 999999 !important; box-shadow: 0 8px 24px rgba(0,0,0,0.4); pointer-events: none; white-space: normal;">
              <p style="margin: 0;">Effective primer concentration assumed for in silico Tm calculation. Typical range: 25-1000 nM.</p>
              <span style="position: absolute; top: -6px; left: 20px; width: 0; height: 0; border-left: 6px solid transparent; border-right: 6px solid transparent; border-bottom: 6px solid #1f2937;"></span>
            </span>
          </span>
        </label>
        <input type="number" id="primer-conc" value="500" min="50" max="2000" step="50">
      </div>
      <div style="position: relative; overflow: visible;">
        <label class="aside" style="display: flex; align-items: center; gap: 6px; position: relative; overflow: visible;">
          <span>Na⁺ (mM)</span>
          <span class="help-icon" style="position: relative; display: inline-block; cursor: help; z-index: 1; flex-shrink: 0;">
            <span style="display: inline-block; width: 16px; height: 16px; line-height: 16px; text-align: center; border-radius: 50%; background: #6b7280; color: white; font-size: 0.7rem; font-weight: bold; transition: background 0.2s; position: relative; z-index: 1;">?</span>
            <span class="help-tooltip" style="position: absolute; top: calc(100% + 10px); left: 0; width: 280px; padding: 12px; background: #1f2937; color: #fff; border-radius: 8px; font-size: 0.85rem; line-height: 1.5; opacity: 0; visibility: hidden; transition: opacity 0.3s, visibility 0.3s; z-index: 999999 !important; box-shadow: 0 8px 24px rgba(0,0,0,0.4); pointer-events: none; white-space: normal;">
              <p style="margin: 0;">Monovalent cation concentration used for salt-corrected Tm calculation. Typical range: 10-200 mM.</p>
              <span style="position: absolute; top: -6px; left: 20px; width: 0; height: 0; border-left: 6px solid transparent; border-right: 6px solid transparent; border-bottom: 6px solid #1f2937;"></span>
            </span>
          </span>
        </label>
        <input type="number" id="na-conc" value="50" min="0" max="200" step="5">
      </div>
      <div style="position: relative; overflow: visible;">
        <label class="aside" style="display: flex; align-items: center; gap: 6px; position: relative; overflow: visible;">
          <span>Mg²⁺ (mM)</span>
          <span class="help-icon" style="position: relative; display: inline-block; cursor: help; z-index: 1; flex-shrink: 0;">
            <span style="display: inline-block; width: 16px; height: 16px; line-height: 16px; text-align: center; border-radius: 50%; background: #6b7280; color: white; font-size: 0.7rem; font-weight: bold; transition: background 0.2s; position: relative; z-index: 1;">?</span>
            <span class="help-tooltip" style="position: absolute; top: calc(100% + 10px); left: 0; width: 280px; padding: 12px; background: #1f2937; color: #fff; border-radius: 8px; font-size: 0.85rem; line-height: 1.5; opacity: 0; visibility: hidden; transition: opacity 0.3s, visibility 0.3s; z-index: 999999 !important; box-shadow: 0 8px 24px rgba(0,0,0,0.4); pointer-events: none; white-space: normal;">
              <p style="margin: 0;">Divalent cation concentration used for Tm calculation. Set to 0 if Mg²⁺ is absent from reaction. Typical range: 0.5-5 mM.</p>
              <span style="position: absolute; top: -6px; left: 20px; width: 0; height: 0; border-left: 6px solid transparent; border-right: 6px solid transparent; border-bottom: 6px solid #1f2937;"></span>
            </span>
          </span>
        </label>
        <input type="number" id="mg-conc" value="2.0" min="0" max="10" step="0.5">
      </div>
    </div>
    <div class="grid cols-2" style="margin-top:12px;">
      <div style="position: relative; overflow: visible;">
        <label class="aside" style="display: flex; align-items: center; gap: 6px; position: relative; overflow: visible;">
          <span>Forward primer overlap sequence (optional)</span>
          <span class="help-icon" style="position: relative; display: inline-block; cursor: help; z-index: 1; flex-shrink: 0;">
            <span style="display: inline-block; width: 16px; height: 16px; line-height: 16px; text-align: center; border-radius: 50%; background: #6b7280; color: white; font-size: 0.7rem; font-weight: bold; transition: background 0.2s; position: relative; z-index: 1;">?</span>
            <span class="help-tooltip" style="position: absolute; top: calc(100% + 10px); left: 0; width: 350px; padding: 12px; background: #1f2937; color: #fff; border-radius: 8px; font-size: 0.85rem; line-height: 1.5; opacity: 0; visibility: hidden; transition: opacity 0.3s, visibility 0.3s; z-index: 999999 !important; box-shadow: 0 8px 24px rgba(0,0,0,0.4); pointer-events: none; white-space: normal;">
              <p style="margin: 0 0 8px 0;">Optional sequence to append to the 5' end of the forward primer for the first fragment. This sequence will be added to the beginning of F1 primer.</p>
              <p style="margin: 0; padding-top: 8px; border-top: 1px solid rgba(255,255,255,0.2);"><strong>Note:</strong> The overlap sequence does not participate in Tm calculation. Tm is calculated based on the core primer sequence only.</p>
              <span style="position: absolute; top: -6px; left: 20px; width: 0; height: 0; border-left: 6px solid transparent; border-right: 6px solid transparent; border-bottom: 6px solid #1f2937;"></span>
            </span>
          </span>
        </label>
        <input type="text" id="f-overlap-seq" placeholder="e.g., GGGGAATTCC">
      </div>
      <div style="position: relative; overflow: visible;">
        <label class="aside" style="display: flex; align-items: center; gap: 6px; position: relative; overflow: visible;">
          <span>Reverse primer overlap sequence (optional)</span>
          <span class="help-icon" style="position: relative; display: inline-block; cursor: help; z-index: 1; flex-shrink: 0;">
            <span style="display: inline-block; width: 16px; height: 16px; line-height: 16px; text-align: center; border-radius: 50%; background: #6b7280; color: white; font-size: 0.7rem; font-weight: bold; transition: background 0.2s; position: relative; z-index: 1;">?</span>
            <span class="help-tooltip" style="position: absolute; top: calc(100% + 10px); left: 0; width: 350px; padding: 12px; background: #1f2937; color: #fff; border-radius: 8px; font-size: 0.85rem; line-height: 1.5; opacity: 0; visibility: hidden; transition: opacity 0.3s, visibility 0.3s; z-index: 999999 !important; box-shadow: 0 8px 24px rgba(0,0,0,0.4); pointer-events: none; white-space: normal;">
              <p style="margin: 0 0 8px 0;">Optional sequence to append to the 5' end of the reverse primer for the last fragment. This sequence will be reverse complemented and added to the beginning of RN primer.</p>
              <p style="margin: 0; padding-top: 8px; border-top: 1px solid rgba(255,255,255,0.2);"><strong>Note:</strong> The overlap sequence does not participate in Tm calculation. Tm is calculated based on the core primer sequence only.</p>
              <span style="position: absolute; top: -6px; left: 20px; width: 0; height: 0; border-left: 6px solid transparent; border-right: 6px solid transparent; border-bottom: 6px solid #1f2937;"></span>
            </span>
          </span>
        </label>
        <input type="text" id="r-overlap-seq" placeholder="e.g., GGCCGGATCC">
      </div>
    </div>
    <div class="row" style="margin-top:20px; justify-content: space-between;">
      <div class="row" style="gap:8px;flex-wrap:nowrap">
        <button class="btn" id="design-btn">Design Primers</button>
      </div>
      <button class="btn ghost" id="clear-btn">Clear</button>
    </div>
  </div>

  <div id="results" style="display:none;margin-top:16px;">
    <h2>Design Results</h2>
    <div id="results-content"></div>
  </div>
</div>

<style>
:root{
  --ok:#16a34a;
  --warn:#d97706;
  --danger:#b91c1c;
}
.fragment-table input, .fragment-table textarea {
  width: 100%;
  margin: 0;
  padding: 4px 6px;
  font-size: 0.85rem;
  border: 1px solid var(--line);
}
.fragment-table textarea {
  min-height: 60px;
  font-size: 0.8rem;
}
.fragment-table {
  position: relative;
}
.fragment-table .linker-column {
  position: relative;
  overflow: visible;
  isolation: isolate;
}
.fragment-table .linker-column > div {
  position: relative;
  overflow: visible;
}
.fragment-table .linker-column select {
  position: relative;
}
.fragment-table tbody tr {
  position: relative;
}
.badge{
  display:inline-block;
  border-radius:999px;
  padding:2px 8px;
  font-size:11px;
  font-weight:600;
  border:1px solid transparent;
  white-space:nowrap;
}
.badge.ok{background:#ecfdf3;color:var(--ok);border-color:#bbf7d0;}
.badge.warn{background:#fffbeb;color:var(--warn);border-color:#fed7aa;}
.badge.bad{background:#fef2f2;color:var(--danger);border-color:#fecaca;}
.help-icon {
  position: relative;
  display: inline-block;
  cursor: help;
  z-index: 1;
  flex-shrink: 0;
  overflow: visible;
}
.help-icon:hover .help-tooltip,
.help-icon:focus-within .help-tooltip {
  opacity: 1 !important;
  visibility: visible !important;
}
.help-icon:hover span:first-child {
  background: #4b5563;
}
.help-icon span:first-child {
  display: inline-block;
  width: 16px;
  height: 16px;
  line-height: 16px;
  text-align: center;
  border-radius: 50%;
  background: #6b7280;
  color: white;
  font-size: 0.7rem;
  font-weight: bold;
  transition: background 0.2s;
  position: relative;
  z-index: 1;
}
.help-tooltip {
  word-wrap: break-word;
  z-index: 999999 !important;
  position: absolute !important;
  padding: 12px;
  background: #1f2937;
  color: #fff;
  border-radius: 8px;
  font-size: 0.85rem;
  line-height: 1.5;
  opacity: 0;
  visibility: hidden;
  transition: opacity 0.3s, visibility 0.3s;
  box-shadow: 0 8px 24px rgba(0,0,0,0.4);
  pointer-events: none;
  white-space: normal;
  max-width: 350px;
}
.help-icon:hover {
  z-index: 999998 !important;
}
.linker-display {
  color: var(--ok);
  font-weight: 500;
}
.linker-type-btn {
  padding: 4px 8px;
  border: 1px solid var(--line);
  border-radius: 6px;
  background: #f9fafb;
  cursor: pointer;
  font-size: 12px;
  white-space: nowrap;
  transition: all 0.2s;
}
.linker-type-btn:hover {
  background: #f1f5f9;
}
#results.show {
  display: block;
}
.fragment-name {
  font-weight: 600;
  color: var(--brand);
}
.btn.success {
  background: var(--ok);
  color: #fff;
}
</style>
